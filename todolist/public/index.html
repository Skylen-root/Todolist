<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <!-- <script src="script.js" defer></script> -->

</head>
<body>
    <div class="wrapper">
        <!-- <div class="control-panel">
            <input class="addItem" type="text"><input type="button" id="add" value="add">

        </div> -->




        <!-- <div class="todolist">
            <form name="userForm">
                <input type="hidden" name="id" value="0" />
                <div class="form-group">
                    <label for="name">Имя:</label>
                    <input class="form-control" name="name" />
                </div>
                <div class="form-group">
                    <label for="age">Возраст:</label>
                    <input class="form-control" name="age" />
                </div>
                <div class="panel-body">
                    <button type="submit" class="btn btn-sm btn-primary">Сохранить</button>
                    <a id="reset" class="btn btn-sm btn-primary">Сбросить</a>
                </div>
            </form> -->


            <form name="todolist">
                <label for="title">Title</label>
                <input name="title">
                <label for="content">Content</label>
                <input name="content">
                <button type="submit">Create</button>
                <div>
                    <label for="deleteTask">Delete User by id</label>
                    <input name="deleteTask">
                    <button id="deletetask" type="button">Delete</button><span id = "sp"></span>
                </div>
            </form>


            <button type="button" id="get-tasks-list">Get Tasks List</button>
            <div id="tasks-list">

            </div>

            

        </div>

        <div class="row">
            <div id="out">
            
    
                
    
            </div>
            <div id="out2">
                
                
    
            </div>
        </div>

        
    </div>
    
    <script>

        let taskList;




        async function CreateUser(title, content) {

            const response = await fetch("http://localhost:3000/api/newtask", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    title: title,
                    content: content
                })
            });
            if (response.ok === true) {
                result = await response.json();
                console.log(result);
            }
            // if (response.ok === true) {
            //     const user = await response.json();
            //     reset();
            //     document.querySelector("tbody").append(row(user));
            // }
        }

        async function DeleteUser(id) {

            const response = await fetch("http://localhost:3000/api/task", {
                method: "DELETE",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    id: id
                })
            });
            if(response.ok === true) {
                result = await response.json();
                if(result === 0){
                    document.querySelector("#sp").innerHTML = "User not found";
                }
                else {
                    document.querySelector("#sp").innerHTML = "Done"
                }
            }

        }


        async function GetTaskList(){
            const response = await fetch("http://localhost:3000/api/tasks", {
                method: "GET",
                headers: { "Accept": "application/json" }
            })
            if(response.ok === true) {
                result = await response.json();
                //result = JSON.stringify(result);
                //result = JSON.parse(result);
                //console.log(typeof result)
                //console.log(result)
                //result = JSON.parse(result);
                //return JSON.stringify(result);
                return result;
                //document.querySelector("#tasks-list").innerHTML = JSON.stringify(result);
            }
            else {
                return "Something wrong";
            }




        }


        document.forms["todolist"].addEventListener("submit", e => {
            e.preventDefault();
            const form = document.forms["todolist"];
            const title = form.elements["title"].value;
            const content = form.elements["content"].value;
            CreateUser(title,content);
        });


        document.querySelector("#deletetask").addEventListener("click", e => {
            const form = document.forms["todolist"];
            const id = form.elements["deleteTask"].value;
            DeleteUser(id);
        })



        document.querySelector("#get-tasks-list").addEventListener("click", e => {
            taskList =  GetTaskList();
            //taskList = taskList.json();
            let a;
            taskList.then(
                function(result){
                    a = result;
                    a = JSON.stringify(a);
                    //document.querySelector("#tasks-list").innerHTML = a;
                    //console.log(result[55])
                    ShowList(result);
                },
                function(error){console.log(error);}
            )
            //console.log(taskList);
            //taskList.then()
            
        })

        

        function ShowList(list) {

            let out;
            for(let i in list) {
                out = `<div>
    <h4>${list[i].title}</h4>
    <p>${list[i].content}</p>
</div>`
            }




            document.querySelector("#tasks-list").innerHTML = out;
        }




</script>

</body>
</html>